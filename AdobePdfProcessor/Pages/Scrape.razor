@page "/scrape"
@using DataLibrary.DbAccess
@using DataLibrary.DbServices
@using DataLibrary.Models
@using DataLibrary.Services;
@using DataLibrary.Services.SDATScrapers
@inject IRealPropertySearchScraper scraper
@inject IDataContext dataContext
@inject IGroundRentProcessorDataServiceFactory groundRentProcessorDataServiceFactory

<div class="row mb-3 mt-3">
    <div class="container">
        <div>
            <p>Click Once</p>
            <button class="btn btn-danger" type="submit" @onclick="ScrapeSDAT">Scrape</button>
            @*<button class="btn btn-danger" type="submit" @onclick="CloseApp">CloseApp</button>*@
        </div>
    </div>
    <div class="container">
        <div>
            <p>View the console window for progress related to the scrape.</p>
            <p>When you need to close the app, simply close the console window.</p>
        </div>
    </div>
</div>

@code {
    private int amountToScrape = 40000;
    private async Task ScrapeSDAT()
    {
        List<AddressModel> firefoxAddressList;
        using (var uow = dataContext.CreateUnitOfWork())
        {
            var groundRentProcessorDataService = groundRentProcessorDataServiceFactory.CreateGroundRentProcessorDataService(uow);
            firefoxAddressList = await groundRentProcessorDataService.ReadTopAmountWhereIsGroundRentNull(amountToScrape);
        }
        scraper.AllocateWebDrivers(firefoxAddressList);
    }
    private void CloseApp()
    {
        // Todo
    }
}
