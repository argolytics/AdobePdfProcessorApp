@page "/scrape"
@using DataLibrary.DbAccess
@using DataLibrary.DbServices
@using DataLibrary.Models
@using DataLibrary.Services;
@using DataLibrary.Services.SDATScrapers
@inject IRealPropertySearchScraper scraper
@inject IDataContext dataContext
@inject IAddressDataServiceFactory addressDataServiceFactory

<div class="row mb-3 mt-3">
    <div class="container">
        <div>
            <p>Click Once</p>
            <button class="btn btn-danger" type="submit" @onclick="ScrapeBaltimoreCity">ScrapeBaltimoreCity</button>
            @*<button class="btn btn-danger" type="submit" @onclick="CloseApp">CloseApp</button>*@
        </div>
    </div>
    <div class="container">
        <div>
            <p>View the console window for progress related to the scrape.</p>
            <p>When you need to close the app, simply close the console window.</p>
        </div>
    </div>
</div>

@code {
    private int amountToScrape = 15000;
    private async Task ScrapeBaltimoreCity()
    {
        List<AddressModel> chromeAddressList;
        List<AddressModel> edgeAddressList;
        List<AddressModel> firefoxAddressList;
        List<AddressModel> ieAddressList;
        using (var uow = dataContext.CreateUnitOfWork())
        {
            var addressDataService = addressDataServiceFactory.CreateAddressDataService(uow);
            firefoxAddressList = await addressDataService.ReadAddressTopAmountWhereIsGroundRentNullAndYearBuiltZeroBaltimoreCity1(amountToScrape);
        }
        scraper.AllocateWebDrivers(firefoxAddressList);
        Console.WriteLine("Scrape complete.");
    }
    private void CloseApp()
    {
        // Todo
    }
}
